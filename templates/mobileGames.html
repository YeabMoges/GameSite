{% extends 'mobile_base.html' %}

{% block title %}Mobile Games - GameSite{% endblock %}

{% block content %}

<!-- Advertisement Section -->
<div class="d-flex justify-content-center align-items-center mt-3">
    <div class="text-center">
        <iframe
            id="random-ad-video"
            width="1600"
            height="400"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
        </iframe>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const videoIds = [
            '44MOkHyEvJs',
            'R8htow_6tRc',
            'QLuShrJyurE',
            'mfm0VHQJZxE',
            'GajGrj7HLQM',
            'uA16fjZArkY',
            'w8vPZrMFiZ4',
            'zCX-Tz8KpXE',
            'Nkhvl4Sazj4',
            'ot7uXNQskhs',
            'M0niPfYZaaI',
        ];

        let shuffledVideos = [...videoIds].sort(() => Math.random() - 0.5);
        let currentIndex = 0;

        const iframe = document.getElementById('random-ad-video');

        function playVideo(videoId) {
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&enablejsapi=1&rel=0&loop=1&playlist=${shuffledVideos.join(',')}`;
        }

        function playNextVideo() {
            currentIndex = (currentIndex + 1) % shuffledVideos.length;
            playVideo(shuffledVideos[currentIndex]);
        }

        iframe.addEventListener('load', function () {
            const player = new YT.Player('random-ad-video', {
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });

            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.ENDED) {
                    playNextVideo();
                }
            }
        });

        // Shuffle and start the first video
        playVideo(shuffledVideos[currentIndex]);
    });

    // Load the YouTube IFrame API script
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
</script>



<div class="row mt-5">
    <!-- Left Navigation Pane with Collapsible Menu -->
    <div class="col-lg-2 col-md-3">
        <h4 class="header-button-style">Genres</h4>
        <div class="accordion" id="genreAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingGenres">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGenres" aria-expanded="true" aria-controls="collapseGenres">
                        Select Genre
                    </button>
                </h2>
                <div id="collapseGenres" class="accordion-collapse collapse show" aria-labelledby="headingGenres">
                    <div class="accordion-body p-0">
                        <ul class="list-group">
                            <li class="list-group-item p-0"><a href="#" class="btn btn-warning w-100 filter" data-genre="all">All Games</a></li>
                            <li class="list-group-item p-0"><a href="#" class="btn btn-warning w-100 filter" data-genre="action-rpg">Action RPG Games</a></li>
                            <li class="list-group-item p-0"><a href="#" class="btn btn-warning w-100 filter" data-genre="strategy">Strategy</a></li>
                            <li class="list-group-item p-0"><a href="#" class="btn btn-warning w-100 filter" data-genre="puzzle">Puzzles</a></li>
                            <li class="list-group-item p-0"><a href="#" class="btn btn-warning w-100 filter" data-genre="casual">Casual</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content: Mobile Games -->
    <div class="col-lg-8 col-md-6">
        <div class="text-center">
            <h2 class="header-button-style">Mobile Games</h2>
        </div>
        <div class="row mt-4" id="games-list">
            {% for game in games %}
            <div class="col-lg-3 col-md-6 mb-4 game-card" data-genre="{{ game['genre'] }}">
                <a href="{{ game['official_link'] }}" target="_blank" class="game-card-link">
                <div class="card">
                    <img src="{{ game['image_url'] }}" class="card-img-top" alt="{{ game['name'] }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ game['name'] }}</h5>
                        <p class="card-text">{{ game['description'] }}</p>
                        <p class="card-text"><strong>Price:</strong> {{ game['price'] }}</p>
                        <a href="{{ game['store_link'] }}" class="btn btn-primary" target="_blank">View on Store</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Right Banner Section -->
    <div class="col-lg-2 col-md-3">
        <h4 class="header-button-style">Top Off Here !</h4>
        <div class="banner-container">
            <a href="https://www.codashop.com/en-us" target="_blank">
                <img src="{{ url_for('static', filename='images/banner1.jpg') }}" class="banner-img" alt="Ad Banner 1">
            </a>
        </div>
        <div class="banner-container">
            <a href="https://play.google/giftcards/#where-to-buy" target="_blank">
                <img src="{{ url_for('static', filename='images/banner2.jpg') }}" class="banner-img" alt="Ad Banner 2">
            </a>
        </div>
        <div class="banner-container">
            <a href="https://www.apple.com/shop/gift-cards" target="_blank">
                <img src="{{ url_for('static', filename='images/banner3.jpg') }}" class="banner-img" alt="Ad Banner 3">
            </a>
        </div>
    </div>

<!-- Script to Handle Filtering -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const filterLinks = document.querySelectorAll('.filter');
        const gameCards = document.querySelectorAll('.game-card');

        filterLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const genre = this.dataset.genre;

                gameCards.forEach(card => {
                    if (genre === 'all' || card.dataset.genre === genre) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    });
</script>

{% endblock %}
